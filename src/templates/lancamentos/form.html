{% extends "layout.html" %}

{% block title %}{% if action == 'editar' %}Editar{% else %}Novo{% endif %} Lançamento{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold" style="color: #f9fafb;">
        {% if action == 'editar' %}Editar Lançamento{% else %}Novo Lançamento{% endif %}
    </h2>
    <a href="{{ url_for('lancamentos.index') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Voltar
    </a>
</div>

<div class="ls-card p-4">
    <form method="POST">
        <div class="row">
            <div class="col-md-4 mb-3">
                <label class="form-label">Data do Evento *</label>
                <input type="date" name="data_evento" class="form-control"
                    value="{{ lancamento.data_evento if lancamento else '' }}" required style="background-color: rgba(30, 41, 59, 0.8); border-color: rgba(148, 163, 184, 0.25); color: #e5e7eb;">
            </div>

            <div class="col-md-4 mb-3">
                <label class="form-label">Data de Vencimento *</label>
                <input type="date" name="data_vencimento" class="form-control"
                    value="{{ lancamento.data_vencimento if lancamento else '' }}" required style="background-color: rgba(30, 41, 59, 0.8); border-color: rgba(148, 163, 184, 0.25); color: #e5e7eb;">
            </div>

            <div class="col-md-4 mb-3">
                <label class="form-label">Data de Pagamento</label>
                <input type="date" name="data_pagamento" class="form-control"
                    value="{{ lancamento.data_pagamento if lancamento else '' }}" style="background-color: rgba(30, 41, 59, 0.8); border-color: rgba(148, 163, 184, 0.25); color: #e5e7eb;">
            </div>
        </div>

        <div class="row">
            <div class="col-md-4 mb-3">
                <label class="form-label">Conta de Fluxo *</label>
                <select name="fluxo_conta_id" class="form-control" required style="background-color: rgba(30, 41, 59, 0.8); border-color: rgba(148, 163, 184, 0.25); color: #e5e7eb;">
                    <option value="">Selecione...</option>
                    {% for cf in contas_fluxo %}
                    <option value="{{ cf.id }}" {% if lancamento and lancamento.fluxo_conta_id == cf.id %}selected{% endif %}>
                        {{ cf.codigo }} - {{ cf.descricao }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-4 mb-3">
                <label class="form-label">Conta de Banco *</label>
                <select name="conta_banco_id" class="form-control" required style="background-color: rgba(30, 41, 59, 0.8); border-color: rgba(148, 163, 184, 0.25); color: #e5e7eb;">
                    <option value="">Selecione...</option>
                    {% for cb in contas_banco %}
                    <option value="{{ cb.id }}" {% if lancamento and lancamento.conta_banco_id == cb.id %}selected{% endif %}>
                        {{ cb.nome }} - {{ cb.banco }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-4 mb-3">
                <label class="form-label">Entidade (Cliente/Fornecedor) *</label>
                <select name="entidade_id" class="form-control" required style="background-color: rgba(30, 41, 59, 0.8); border-color: rgba(148, 163, 184, 0.25); color: #e5e7eb;">
                    <option value="">Selecione...</option>
                    {% for ent in entidades %}
                    <option value="{{ ent.id }}" {% if lancamento and lancamento.entidade_id == ent.id %}selected{% endif %}>
                        {{ ent.nome }} ({{ ent.cnpj_cpf }})
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4 mb-3">
                <label class="form-label">Número do Documento *</label>
                <input type="text" name="numero_documento" class="form-control"
                    value="{{ lancamento.numero_documento if lancamento else '' }}" required style="background-color: rgba(30, 41, 59, 0.8); border-color: rgba(148, 163, 184, 0.25); color: #e5e7eb;">
            </div>

            <div class="col-md-2 mb-3">
                <label class="form-label">Valor Real *</label>
                <input type="number" name="valor_real" class="form-control" step="0.01"
                    value="{{ lancamento.valor_real if lancamento else '0' }}" required style="background-color: rgba(30, 41, 59, 0.8); border-color: rgba(148, 163, 184, 0.25); color: #e5e7eb;">
            </div>

            <div class="col-md-2 mb-3">
                <label class="form-label">Valor Pago</label>
                <input type="number" name="valor_pago" class="form-control" step="0.01"
                    value="{{ lancamento.valor_pago if lancamento else '0' }}" style="background-color: rgba(30, 41, 59, 0.8); border-color: rgba(148, 163, 184, 0.25); color: #e5e7eb;">
            </div>
        </div>

        <div class="row">
            <div class="col-12 mb-3">
                <label class="form-label">Observações</label>
                <textarea name="observacoes" class="form-control" rows="3" style="background-color: rgba(30, 41, 59, 0.8); border-color: rgba(148, 163, 184, 0.25); color: #e5e7eb;">{{ lancamento.observacoes if lancamento else '' }}</textarea>
            </div>
        </div>

        <div class="d-flex gap-2">
            <button type="submit" class="btn ls-btn-primary">
                <i class="fas fa-save"></i> Salvar
            </button>
            <a href="{{ url_for('lancamentos.index') }}" class="btn btn-outline-secondary">
                Cancelar
            </a>
        </div>
    </form>
</div>

<style>
    .form-control:focus, .form-select:focus {
        border-color: #2563eb !important;
        box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.25) !important;
    }
</style>
{% endblock %}
